{"ast":null,"code":"import React,{useEffect,useState}from\"react\";import FullCalendar from\"@fullcalendar/react\";import dayGridPlugin from\"@fullcalendar/daygrid\";import interactionPlugin from\"@fullcalendar/interaction\";import axios from\"axios\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CLIENT_ID=\"16844726883-nktuvt7v0fvoua9h948nvvl5ljddau9p.apps.googleusercontent.com\";const SCOPES=\"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar\";function CalendarComponent(){const[events,setEvents]=useState([]);const[error,setError]=useState(null);const[token,setToken]=useState(null);const[selectedRoom,setSelectedRoom]=useState(\"\");const[availableTimes,setAvailableTimes]=useState([]);const[formData,setFormData]=useState({date:\"\",time:\"\",email:\"\"});const rooms=[{id:\"room10\",name:\"Salle 10\",times:[\"09:00\",\"10:00\",\"11:00\"]},{id:\"room20\",name:\"Salle 20\",times:[\"12:00\",\"13:00\",\"14:00\"]}];// Charger les événements depuis Flask\nuseEffect(()=>{axios.get(\"http://127.0.0.1:5000/api/reservations\").then(response=>{const formattedEvents=response.data.map(event=>({title:`Salle ${event.room_id} - Réservé par ${event.email}`,start:event.start_time,end:event.end_time}));setEvents(formattedEvents);}).catch(error=>{console.error(\"Erreur lors du chargement des réservations depuis Flask :\",error);setError(\"Erreur lors du chargement des réservations.\");});},[]);// Vérification du token stocké dans localStorage\nuseEffect(()=>{const storedToken=localStorage.getItem(\"googleToken\");if(storedToken){setToken(storedToken);// Définir le token pour l'utiliser dans la page du calendrier\n}else{setError(\"Vous devez être connecté pour accéder au calendrier.\");window.location.href=\"/login\";// Rediriger vers la page de login si le token n'existe pas\n}},[]);// Ajouter une réservation à Flask\nconst addReservationToFlask=reservation=>{axios.post(\"http://127.0.0.1:5000/api/reservations\",reservation).then(response=>{const data=response.data;setEvents(prevEvents=>[...prevEvents,{title:`Salle ${data.room_id} - Réservé par ${data.email}`,start:data.start_time,end:data.end_time}]);}).catch(error=>{console.error(\"Erreur lors de l'ajout de la réservation dans Flask :\",error);setError(\"Erreur lors de l'ajout de la réservation.\");});};// Gérer le changement de salle\nconst handleRoomChange=e=>{const room=rooms.find(r=>r.id===e.target.value);setSelectedRoom(room.id);setAvailableTimes(room.times);};// Gérer la soumission du formulaire de réservation\nconst handleReservation=e=>{e.preventDefault();if(!token){setError(\"Vous devez être connecté pour ajouter une réservation.\");return;}const newReservation={room_id:selectedRoom,email:formData.email,start_time:`${formData.date}T${formData.time}`,end_time:`${formData.date}T${parseInt(formData.time.split(\":\")[0])+1}:00:00`};addReservationToFlask(newReservation);setFormData({date:\"\",time:\"\",email:\"\"});};return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h1\",{children:\"R\\xE9servations de salles\"}),error&&/*#__PURE__*/_jsx(\"p\",{style:{color:\"red\"},children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleReservation,children:[/*#__PURE__*/_jsx(\"label\",{children:\"Salle : \"}),/*#__PURE__*/_jsxs(\"select\",{onChange:handleRoomChange,value:selectedRoom,required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"S\\xE9lectionnez une salle\"}),rooms.map(room=>/*#__PURE__*/_jsx(\"option\",{value:room.id,children:room.name},room.id))]}),/*#__PURE__*/_jsx(\"label\",{children:\"Date : \"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:formData.date,onChange:e=>setFormData({...formData,date:e.target.value}),required:true}),/*#__PURE__*/_jsx(\"label\",{children:\"Heure : \"}),/*#__PURE__*/_jsxs(\"select\",{value:formData.time,onChange:e=>setFormData({...formData,time:e.target.value}),required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",disabled:true,children:\"S\\xE9lectionnez une heure\"}),availableTimes.map(time=>/*#__PURE__*/_jsx(\"option\",{value:time,children:time},time))]}),/*#__PURE__*/_jsx(\"label\",{children:\"Email : \"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:formData.email,onChange:e=>setFormData({...formData,email:e.target.value}),required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",children:\"R\\xE9server\"})]}),/*#__PURE__*/_jsx(FullCalendar,{plugins:[dayGridPlugin,interactionPlugin],initialView:\"dayGridMonth\",events:events,headerToolbar:{left:\"prev,next today\",center:\"title\",right:\"dayGridMonth,dayGridWeek,dayGridDay\"}})]});}export default CalendarComponent;","map":{"version":3,"names":["React","useEffect","useState","FullCalendar","dayGridPlugin","interactionPlugin","axios","jsx","_jsx","jsxs","_jsxs","CLIENT_ID","SCOPES","CalendarComponent","events","setEvents","error","setError","token","setToken","selectedRoom","setSelectedRoom","availableTimes","setAvailableTimes","formData","setFormData","date","time","email","rooms","id","name","times","get","then","response","formattedEvents","data","map","event","title","room_id","start","start_time","end","end_time","catch","console","storedToken","localStorage","getItem","window","location","href","addReservationToFlask","reservation","post","prevEvents","handleRoomChange","e","room","find","r","target","value","handleReservation","preventDefault","newReservation","parseInt","split","children","style","color","onSubmit","onChange","required","disabled","type","plugins","initialView","headerToolbar","left","center","right"],"sources":["C:/projet_cloud_final/frontend/frontend/src/CalendarComponent.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport FullCalendar from \"@fullcalendar/react\";\r\nimport dayGridPlugin from \"@fullcalendar/daygrid\";\r\nimport interactionPlugin from \"@fullcalendar/interaction\";\r\nimport axios from \"axios\";\r\n\r\nconst CLIENT_ID = \"16844726883-nktuvt7v0fvoua9h948nvvl5ljddau9p.apps.googleusercontent.com\";\r\nconst SCOPES = \"https://www.googleapis.com/auth/calendar.events https://www.googleapis.com/auth/calendar\";\r\n\r\nfunction CalendarComponent() {\r\n  const [events, setEvents] = useState([]);\r\n  const [error, setError] = useState(null);\r\n  const [token, setToken] = useState(null);\r\n  const [selectedRoom, setSelectedRoom] = useState(\"\");\r\n  const [availableTimes, setAvailableTimes] = useState([]);\r\n  const [formData, setFormData] = useState({\r\n    date: \"\",\r\n    time: \"\",\r\n    email: \"\",\r\n  });\r\n\r\n  const rooms = [\r\n    { id: \"room10\", name: \"Salle 10\", times: [\"09:00\", \"10:00\", \"11:00\"] },\r\n    { id: \"room20\", name: \"Salle 20\", times: [\"12:00\", \"13:00\", \"14:00\"] },\r\n  ];\r\n\r\n  // Charger les événements depuis Flask\r\n  useEffect(() => {\r\n    axios\r\n      .get(\"http://127.0.0.1:5000/api/reservations\")\r\n      .then((response) => {\r\n        const formattedEvents = response.data.map((event) => ({\r\n          title: `Salle ${event.room_id} - Réservé par ${event.email}`, \r\n          start: event.start_time,\r\n          end: event.end_time,\r\n        }));\r\n        setEvents(formattedEvents);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Erreur lors du chargement des réservations depuis Flask :\", error);\r\n        setError(\"Erreur lors du chargement des réservations.\");\r\n      });\r\n  }, []);\r\n\r\n  // Vérification du token stocké dans localStorage\r\n  useEffect(() => {\r\n    const storedToken = localStorage.getItem(\"googleToken\");\r\n\r\n    if (storedToken) {\r\n      setToken(storedToken);  // Définir le token pour l'utiliser dans la page du calendrier\r\n    } else {\r\n      setError(\"Vous devez être connecté pour accéder au calendrier.\");\r\n      window.location.href = \"/login\";  // Rediriger vers la page de login si le token n'existe pas\r\n    }\r\n  }, []);\r\n\r\n  // Ajouter une réservation à Flask\r\n  const addReservationToFlask = (reservation) => {\r\n    axios\r\n      .post(\"http://127.0.0.1:5000/api/reservations\", reservation)\r\n      .then((response) => {\r\n        const data = response.data;\r\n        setEvents((prevEvents) => [\r\n          ...prevEvents,\r\n          {\r\n            title: `Salle ${data.room_id} - Réservé par ${data.email}`, \r\n            start: data.start_time,\r\n            end: data.end_time,\r\n          },\r\n        ]);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Erreur lors de l'ajout de la réservation dans Flask :\", error);\r\n        setError(\"Erreur lors de l'ajout de la réservation.\");\r\n      });\r\n  };\r\n\r\n  // Gérer le changement de salle\r\n  const handleRoomChange = (e) => {\r\n    const room = rooms.find((r) => r.id === e.target.value);\r\n    setSelectedRoom(room.id);\r\n    setAvailableTimes(room.times);\r\n  };\r\n\r\n  // Gérer la soumission du formulaire de réservation\r\n  const handleReservation = (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!token) {\r\n      setError(\"Vous devez être connecté pour ajouter une réservation.\");\r\n      return;\r\n    }\r\n\r\n    const newReservation = {\r\n      room_id: selectedRoom,\r\n      email: formData.email,\r\n      start_time: `${formData.date}T${formData.time}`, \r\n      end_time: `${formData.date}T${parseInt(formData.time.split(\":\")[0]) + 1}:00:00`, \r\n    };\r\n\r\n    addReservationToFlask(newReservation);\r\n    setFormData({ date: \"\", time: \"\", email: \"\" });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h1>Réservations de salles</h1>\r\n      {error && <p style={{ color: \"red\" }}>{error}</p>}\r\n\r\n      <form onSubmit={handleReservation}>\r\n        <label>Salle : </label>\r\n        <select onChange={handleRoomChange} value={selectedRoom} required>\r\n          <option value=\"\" disabled>\r\n            Sélectionnez une salle\r\n          </option>\r\n          {rooms.map((room) => (\r\n            <option key={room.id} value={room.id}>\r\n              {room.name}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <label>Date : </label>\r\n        <input\r\n          type=\"date\"\r\n          value={formData.date}\r\n          onChange={(e) => setFormData({ ...formData, date: e.target.value })}\r\n          required\r\n        />\r\n        <label>Heure : </label>\r\n        <select\r\n          value={formData.time}\r\n          onChange={(e) => setFormData({ ...formData, time: e.target.value })}\r\n          required\r\n        >\r\n          <option value=\"\" disabled>\r\n            Sélectionnez une heure\r\n          </option>\r\n          {availableTimes.map((time) => (\r\n            <option key={time} value={time}>\r\n              {time}\r\n            </option>\r\n          ))}\r\n        </select>\r\n        <label>Email : </label>\r\n        <input\r\n          type=\"email\"\r\n          value={formData.email}\r\n          onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n          required\r\n        />\r\n        <button type=\"submit\">Réserver</button>\r\n      </form>\r\n\r\n      <FullCalendar\r\n        plugins={[dayGridPlugin, interactionPlugin]}\r\n        initialView=\"dayGridMonth\"\r\n        events={events}\r\n        headerToolbar={{\r\n          left: \"prev,next today\",\r\n          center: \"title\",\r\n          right: \"dayGridMonth,dayGridWeek,dayGridDay\",\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CalendarComponent;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}